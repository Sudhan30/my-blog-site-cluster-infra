apiVersion: v1
kind: ConfigMap
metadata:
  name: grafana-dashboards
  namespace: web
data:
  dashboards.yaml: |
    apiVersion: 1
    
    providers:
      - name: 'default'
        orgId: 1
        folder: ''
        type: file
        disableDeletion: false
        updateIntervalSeconds: 10
        allowUiUpdates: true
        options:
          path: /var/lib/grafana/dashboards
  
  blog-dashboard.json: |
    {
      "id": null,
      "uid": "blog-dashboard",
      "title": "Blog Monitoring Dashboard",
        "tags": ["blog", "monitoring"],
        "style": "dark",
        "timezone": "browser",
        "panels": [
          {
            "id": 1,
            "title": "Blog Uptime",
            "type": "stat",
            "targets": [
              {
                "expr": "probe_success{job=\"blackbox-http\", instance=\"https://blog.sudharsana.dev\"}",
                "legendFormat": "Blog Uptime"
              }
            ],
            "fieldConfig": {
              "defaults": {
                "color": {
                  "mode": "thresholds"
                },
                "thresholds": {
                  "steps": [
                    {"color": "red", "value": 0},
                    {"color": "green", "value": 1}
                  ]
                }
              }
            },
            "gridPos": {"h": 8, "w": 6, "x": 0, "y": 0}
          },
          {
            "id": 2,
            "title": "Blog Response Time",
            "type": "stat",
            "targets": [
              {
                "expr": "probe_duration_seconds{job=\"blackbox-http\", instance=\"https://blog.sudharsana.dev\"}",
                "legendFormat": "Response Time"
              }
            ],
            "fieldConfig": {
              "defaults": {
                "unit": "s",
                "color": {
                  "mode": "thresholds"
                },
                "thresholds": {
                  "steps": [
                    {"color": "green", "value": 0},
                    {"color": "yellow", "value": 1},
                    {"color": "red", "value": 3}
                  ]
                }
              }
            },
            "gridPos": {"h": 8, "w": 6, "x": 6, "y": 0}
          },
          {
            "id": 3,
            "title": "Total Likes",
            "type": "stat",
            "targets": [
              {
                "expr": "blog_likes_total",
                "legendFormat": "Total Likes"
              }
            ],
            "fieldConfig": {
              "defaults": {
                "color": {
                  "mode": "palette-classic"
                }
              }
            },
            "gridPos": {"h": 8, "w": 6, "x": 12, "y": 0}
          },
          {
            "id": 4,
            "title": "Total Comments",
            "type": "stat",
            "targets": [
              {
                "expr": "blog_comments_total",
                "legendFormat": "Total Comments"
              }
            ],
            "fieldConfig": {
              "defaults": {
                "color": {
                  "mode": "palette-classic"
                }
              }
            },
            "gridPos": {"h": 8, "w": 6, "x": 18, "y": 0}
          },
          {
            "id": 5,
            "title": "HTTP Requests Rate",
            "type": "graph",
            "targets": [
              {
                "expr": "rate(http_requests_total[5m])",
                "legendFormat": "{{method}} {{route}}"
              }
            ],
            "gridPos": {"h": 8, "w": 12, "x": 0, "y": 8}
          },
          {
            "id": 6,
            "title": "HTTP Response Time",
            "type": "graph",
            "targets": [
              {
                "expr": "histogram_quantile(0.95, rate(http_request_duration_seconds_bucket[5m]))",
                "legendFormat": "95th percentile"
              },
              {
                "expr": "histogram_quantile(0.50, rate(http_request_duration_seconds_bucket[5m]))",
                "legendFormat": "50th percentile"
              }
            ],
            "gridPos": {"h": 8, "w": 12, "x": 12, "y": 8}
          },
          {
            "id": 7,
            "title": "Pod CPU Usage",
            "type": "graph",
            "targets": [
              {
                "expr": "rate(container_cpu_usage_seconds_total{pod=~\"blog.*\"}[5m]) * 100",
                "legendFormat": "{{pod}}"
              }
            ],
            "gridPos": {"h": 8, "w": 12, "x": 0, "y": 16}
          },
          {
            "id": 8,
            "title": "Pod Memory Usage",
            "type": "graph",
            "targets": [
              {
                "expr": "container_memory_usage_bytes{pod=~\"blog.*\"} / 1024 / 1024",
                "legendFormat": "{{pod}}"
              }
            ],
            "gridPos": {"h": 8, "w": 12, "x": 12, "y": 16}
          }
        ],
        "time": {
          "from": "now-1h",
          "to": "now"
        },
      "refresh": "30s"
    }
  
  trading-dashboard.json: |
    {
      "id": null,
      "uid": "trading-dashboard",
      "title": "Trading System Monitoring",
        "tags": ["trading", "monitoring", "algo"],
        "style": "dark",
        "timezone": "browser",
        "panels": [
          {
            "id": 1,
            "title": "Trading Pods Status",
            "type": "stat",
            "targets": [
              {
                "expr": "kube_pod_status_ready{namespace=\"trading\", condition=\"true\"}",
                "legendFormat": "{{pod}}"
              }
            ],
            "gridPos": {"h": 4, "w": 24, "x": 0, "y": 0}
          },
          {
            "id": 2,
            "title": "Pod CPU Usage",
            "type": "timeseries",
            "targets": [
              {
                "expr": "rate(container_cpu_usage_seconds_total{namespace=\"trading\", container!=\"\"}[5m]) * 100",
                "legendFormat": "{{container}}"
              }
            ],
            "fieldConfig": {
              "defaults": {
                "unit": "percent"
              }
            },
            "gridPos": {"h": 8, "w": 12, "x": 0, "y": 4}
          },
          {
            "id": 3,
            "title": "Pod Memory Usage",
            "type": "timeseries",
            "targets": [
              {
                "expr": "container_memory_usage_bytes{namespace=\"trading\", container!=\"\"} / 1024 / 1024",
                "legendFormat": "{{container}}"
              }
            ],
            "fieldConfig": {
              "defaults": {
                "unit": "decmbytes"
              }
            },
            "gridPos": {"h": 8, "w": 12, "x": 12, "y": 4}
          },
          {
            "id": 4,
            "title": "TimescaleDB Storage",
            "type": "stat",
            "targets": [
              {
                "expr": "kubelet_volume_stats_used_bytes{namespace=\"trading\", persistentvolumeclaim=~\".*timescale.*\"} / 1024 / 1024 / 1024",
                "legendFormat": "Used GB"
              }
            ],
            "fieldConfig": {
              "defaults": {
                "unit": "decgbytes",
                "color": {
                  "mode": "thresholds"
                },
                "thresholds": {
                  "steps": [
                    {"color": "green", "value": 0},
                    {"color": "yellow", "value": 5},
                    {"color": "red", "value": 8}
                  ]
                }
              }
            },
            "gridPos": {"h": 6, "w": 6, "x": 0, "y": 12}
          },
          {
            "id": 5,
            "title": "Pod Restarts",
            "type": "stat",
            "targets": [
              {
                "expr": "kube_pod_container_status_restarts_total{namespace=\"trading\"}",
                "legendFormat": "{{container}}"
              }
            ],
            "fieldConfig": {
              "defaults": {
                "color": {
                  "mode": "thresholds"
                },
                "thresholds": {
                  "steps": [
                    {"color": "green", "value": 0},
                    {"color": "yellow", "value": 1},
                    {"color": "red", "value": 3}
                  ]
                }
              }
            },
            "gridPos": {"h": 6, "w": 6, "x": 6, "y": 12}
          },
          {
            "id": 6,
            "title": "Network I/O (Received)",
            "type": "timeseries",
            "targets": [
              {
                "expr": "rate(container_network_receive_bytes_total{namespace=\"trading\"}[5m])",
                "legendFormat": "{{pod}}"
              }
            ],
            "fieldConfig": {
              "defaults": {
                "unit": "Bps"
              }
            },
            "gridPos": {"h": 6, "w": 6, "x": 12, "y": 12}
          },
          {
            "id": 7,
            "title": "Network I/O (Transmitted)",
            "type": "timeseries",
            "targets": [
              {
                "expr": "rate(container_network_transmit_bytes_total{namespace=\"trading\"}[5m])",
                "legendFormat": "{{pod}}"
              }
            ],
            "fieldConfig": {
              "defaults": {
                "unit": "Bps"
              }
            },
            "gridPos": {"h": 6, "w": 6, "x": 18, "y": 12}
          }
        ],
        "time": {
          "from": "now-1h",
          "to": "now"
        },
      "refresh": "30s"
    }
  
  phase10a-pacing-dashboard.json: |
    {
      "id": null,
      "uid": "phase10a-pacing",
      "title": "Phase 10A Trade Pacing & Risk",
      "tags": ["trading", "phase10a", "pacing"],
      "style": "dark",
      "timezone": "browser",
      "refresh": "30s",
      "panels": [
        {
          "id": 1,
          "type": "logs",
          "title": "üö´ Entry Gate Events (SOFT/HARD Blocks)",
          "gridPos": {"h": 6, "w": 12, "x": 0, "y": 0},
          "datasource": {"type": "loki", "uid": "loki"},
          "targets": [{"expr": "{namespace=\"trading\"} |= \"ENTRY_BLOCKED\"", "refId": "A"}],
          "options": {"showTime": true, "sortOrder": "Descending"}
        },
        {
          "id": 2,
          "type": "timeseries",
          "title": "üìä SOFT vs HARD Blocks (5m)",
          "gridPos": {"h": 6, "w": 12, "x": 12, "y": 0},
          "datasource": {"type": "loki", "uid": "loki"},
          "targets": [
            {"expr": "count_over_time({namespace=\"trading\"} |= \"ENTRY_BLOCKED\" |= \"SOFT\" [5m])", "legendFormat": "‚è∏Ô∏è SOFT", "refId": "A"},
            {"expr": "count_over_time({namespace=\"trading\"} |= \"ENTRY_BLOCKED\" |= \"HARD\" [5m])", "legendFormat": "üö´ HARD", "refId": "B"}
          ],
          "fieldConfig": {"defaults": {"custom": {"drawStyle": "bars", "fillOpacity": 50}}}
        },
        {
          "id": 3,
          "type": "timeseries",
          "title": "üìà Signal Flow: BUY ‚Üí Order ‚Üí Blocked",
          "gridPos": {"h": 8, "w": 24, "x": 0, "y": 6},
          "datasource": {"type": "loki", "uid": "loki"},
          "targets": [
            {"expr": "count_over_time({namespace=\"trading\"} |= \"BUY signal\" [5m])", "legendFormat": "üìà BUY Signals", "refId": "A"},
            {"expr": "count_over_time({namespace=\"trading\"} |= \"Order placed\" [5m])", "legendFormat": "‚úÖ Orders", "refId": "B"},
            {"expr": "count_over_time({namespace=\"trading\"} |= \"ENTRY_BLOCKED\" [5m])", "legendFormat": "üö´ Blocked", "refId": "C"}
          ]
        },
        {
          "id": 4,
          "type": "logs",
          "title": "üö´ Strategy Loss Cap Blocks",
          "gridPos": {"h": 6, "w": 12, "x": 0, "y": 14},
          "datasource": {"type": "loki", "uid": "loki"},
          "targets": [{"expr": "{namespace=\"trading\"} |= \"RISK BLOCK\"", "refId": "A"}],
          "options": {"showTime": true, "sortOrder": "Descending"}
        },
        {
          "id": 5,
          "type": "logs",
          "title": "‚õî FORBIDDEN Invariant Violations",
          "gridPos": {"h": 6, "w": 12, "x": 12, "y": 14},
          "datasource": {"type": "loki", "uid": "loki"},
          "targets": [{"expr": "{namespace=\"trading\"} |= \"FORBIDDEN\"", "refId": "A"}],
          "options": {"showTime": true, "sortOrder": "Descending"}
        },
        {
          "id": 6,
          "type": "timeseries",
          "title": "üî¥ Error Rate (5m)",
          "gridPos": {"h": 6, "w": 24, "x": 0, "y": 20},
          "datasource": {"type": "loki", "uid": "loki"},
          "targets": [
            {"expr": "count_over_time({namespace=\"trading\"} |= \"ERROR\" [5m])", "legendFormat": "üî¥ Errors", "refId": "A"},
            {"expr": "count_over_time({namespace=\"trading\"} |= \"CRITICAL\" [5m])", "legendFormat": "‚õî Critical", "refId": "B"}
          ],
          "fieldConfig": {"defaults": {"custom": {"drawStyle": "bars", "fillOpacity": 50}}}
        }
      ],
      "time": {"from": "now-6h", "to": "now"}
    }
