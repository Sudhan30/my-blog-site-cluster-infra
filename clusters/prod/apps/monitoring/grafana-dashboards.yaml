apiVersion: v1
kind: ConfigMap
metadata:
  name: grafana-dashboards
  namespace: web
data:
  dashboards.yaml: |
    apiVersion: 1
    
    providers:
      - name: 'default'
        orgId: 1
        folder: ''
        type: file
        disableDeletion: false
        updateIntervalSeconds: 10
        allowUiUpdates: true
        options:
          path: /var/lib/grafana/dashboards
  
  blog-dashboard.json: |
    {
      "dashboard": {
        "id": null,
        "title": "Blog Monitoring Dashboard",
        "tags": ["blog", "monitoring"],
        "style": "dark",
        "timezone": "browser",
        "panels": [
          {
            "id": 1,
            "title": "Blog Uptime",
            "type": "stat",
            "targets": [
              {
                "expr": "probe_success{job=\"blackbox-http\", instance=\"https://blog.sudharsana.dev\"}",
                "legendFormat": "Blog Uptime"
              }
            ],
            "fieldConfig": {
              "defaults": {
                "color": {
                  "mode": "thresholds"
                },
                "thresholds": {
                  "steps": [
                    {"color": "red", "value": 0},
                    {"color": "green", "value": 1}
                  ]
                }
              }
            },
            "gridPos": {"h": 8, "w": 6, "x": 0, "y": 0}
          },
          {
            "id": 2,
            "title": "Blog Response Time",
            "type": "stat",
            "targets": [
              {
                "expr": "probe_duration_seconds{job=\"blackbox-http\", instance=\"https://blog.sudharsana.dev\"}",
                "legendFormat": "Response Time"
              }
            ],
            "fieldConfig": {
              "defaults": {
                "unit": "s",
                "color": {
                  "mode": "thresholds"
                },
                "thresholds": {
                  "steps": [
                    {"color": "green", "value": 0},
                    {"color": "yellow", "value": 1},
                    {"color": "red", "value": 3}
                  ]
                }
              }
            },
            "gridPos": {"h": 8, "w": 6, "x": 6, "y": 0}
          },
          {
            "id": 3,
            "title": "Total Likes",
            "type": "stat",
            "targets": [
              {
                "expr": "blog_likes_total",
                "legendFormat": "Total Likes"
              }
            ],
            "fieldConfig": {
              "defaults": {
                "color": {
                  "mode": "palette-classic"
                }
              }
            },
            "gridPos": {"h": 8, "w": 6, "x": 12, "y": 0}
          },
          {
            "id": 4,
            "title": "Total Comments",
            "type": "stat",
            "targets": [
              {
                "expr": "blog_comments_total",
                "legendFormat": "Total Comments"
              }
            ],
            "fieldConfig": {
              "defaults": {
                "color": {
                  "mode": "palette-classic"
                }
              }
            },
            "gridPos": {"h": 8, "w": 6, "x": 18, "y": 0}
          },
          {
            "id": 5,
            "title": "HTTP Requests Rate",
            "type": "graph",
            "targets": [
              {
                "expr": "rate(http_requests_total[5m])",
                "legendFormat": "{{method}} {{route}}"
              }
            ],
            "gridPos": {"h": 8, "w": 12, "x": 0, "y": 8}
          },
          {
            "id": 6,
            "title": "HTTP Response Time",
            "type": "graph",
            "targets": [
              {
                "expr": "histogram_quantile(0.95, rate(http_request_duration_seconds_bucket[5m]))",
                "legendFormat": "95th percentile"
              },
              {
                "expr": "histogram_quantile(0.50, rate(http_request_duration_seconds_bucket[5m]))",
                "legendFormat": "50th percentile"
              }
            ],
            "gridPos": {"h": 8, "w": 12, "x": 12, "y": 8}
          },
          {
            "id": 7,
            "title": "Pod CPU Usage",
            "type": "graph",
            "targets": [
              {
                "expr": "rate(container_cpu_usage_seconds_total{pod=~\"blog.*\"}[5m]) * 100",
                "legendFormat": "{{pod}}"
              }
            ],
            "gridPos": {"h": 8, "w": 12, "x": 0, "y": 16}
          },
          {
            "id": 8,
            "title": "Pod Memory Usage",
            "type": "graph",
            "targets": [
              {
                "expr": "container_memory_usage_bytes{pod=~\"blog.*\"} / 1024 / 1024",
                "legendFormat": "{{pod}}"
              }
            ],
            "gridPos": {"h": 8, "w": 12, "x": 12, "y": 16}
          }
        ],
        "time": {
          "from": "now-1h",
          "to": "now"
        },
        "refresh": "30s"
      }
    }
  
  trading-dashboard.json: |
    {
      "dashboard": {
        "id": null,
        "title": "Trading System Monitoring",
        "tags": ["trading", "monitoring", "algo"],
        "style": "dark",
        "timezone": "browser",
        "panels": [
          {
            "id": 1,
            "title": "Trading Pods Status",
            "type": "stat",
            "targets": [
              {
                "expr": "kube_pod_status_ready{namespace=\"trading\", condition=\"true\"}",
                "legendFormat": "{{pod}}"
              }
            ],
            "gridPos": {"h": 4, "w": 24, "x": 0, "y": 0}
          },
          {
            "id": 2,
            "title": "Pod CPU Usage",
            "type": "timeseries",
            "targets": [
              {
                "expr": "rate(container_cpu_usage_seconds_total{namespace=\"trading\", container!=\"\"}[5m]) * 100",
                "legendFormat": "{{container}}"
              }
            ],
            "fieldConfig": {
              "defaults": {
                "unit": "percent"
              }
            },
            "gridPos": {"h": 8, "w": 12, "x": 0, "y": 4}
          },
          {
            "id": 3,
            "title": "Pod Memory Usage",
            "type": "timeseries",
            "targets": [
              {
                "expr": "container_memory_usage_bytes{namespace=\"trading\", container!=\"\"} / 1024 / 1024",
                "legendFormat": "{{container}}"
              }
            ],
            "fieldConfig": {
              "defaults": {
                "unit": "decmbytes"
              }
            },
            "gridPos": {"h": 8, "w": 12, "x": 12, "y": 4}
          },
          {
            "id": 4,
            "title": "TimescaleDB Storage",
            "type": "stat",
            "targets": [
              {
                "expr": "kubelet_volume_stats_used_bytes{namespace=\"trading\", persistentvolumeclaim=~\".*timescale.*\"} / 1024 / 1024 / 1024",
                "legendFormat": "Used GB"
              }
            ],
            "fieldConfig": {
              "defaults": {
                "unit": "decgbytes",
                "color": {
                  "mode": "thresholds"
                },
                "thresholds": {
                  "steps": [
                    {"color": "green", "value": 0},
                    {"color": "yellow", "value": 5},
                    {"color": "red", "value": 8}
                  ]
                }
              }
            },
            "gridPos": {"h": 6, "w": 6, "x": 0, "y": 12}
          },
          {
            "id": 5,
            "title": "Pod Restarts",
            "type": "stat",
            "targets": [
              {
                "expr": "kube_pod_container_status_restarts_total{namespace=\"trading\"}",
                "legendFormat": "{{container}}"
              }
            ],
            "fieldConfig": {
              "defaults": {
                "color": {
                  "mode": "thresholds"
                },
                "thresholds": {
                  "steps": [
                    {"color": "green", "value": 0},
                    {"color": "yellow", "value": 1},
                    {"color": "red", "value": 3}
                  ]
                }
              }
            },
            "gridPos": {"h": 6, "w": 6, "x": 6, "y": 12}
          },
          {
            "id": 6,
            "title": "Network I/O (Received)",
            "type": "timeseries",
            "targets": [
              {
                "expr": "rate(container_network_receive_bytes_total{namespace=\"trading\"}[5m])",
                "legendFormat": "{{pod}}"
              }
            ],
            "fieldConfig": {
              "defaults": {
                "unit": "Bps"
              }
            },
            "gridPos": {"h": 6, "w": 6, "x": 12, "y": 12}
          },
          {
            "id": 7,
            "title": "Network I/O (Transmitted)",
            "type": "timeseries",
            "targets": [
              {
                "expr": "rate(container_network_transmit_bytes_total{namespace=\"trading\"}[5m])",
                "legendFormat": "{{pod}}"
              }
            ],
            "fieldConfig": {
              "defaults": {
                "unit": "Bps"
              }
            },
            "gridPos": {"h": 6, "w": 6, "x": 18, "y": 12}
          }
        ],
        "time": {
          "from": "now-1h",
          "to": "now"
        },
        "refresh": "30s"
      }
    }
